# week1 intro

## 1. 知识点：

## Week 1 — Basics of Statistical Computing and Visualisation

*(统计计算与可视化基础)* Week_01 (1)

### 0. Learning goals (what Week 1 is really about)

- Refresh basic statistical concepts you will need for later modelling. Week_01 (1)
- Get comfortable with **R** (统计计算软件) and **RStudio** (R 的集成开发环境 IDE). Week_01 (1)
- Learn **reproducible coding** using **R Markdown** (R Markdown 可复现报告). Week_01 (1)
- Learn basic **data structures** in R and simple data import/export & summaries (数据结构 + 导入导出 + 描述性统计).
- Learn basic **statistical graphics** (统计图形) in base R and ggplot2. Week_01 (1)

> **Exam mindset:**
>  Week 1 provides language + tools you’ll use in *every* later question:
>
> - understanding variable types,
> - reading `summary()` output,
> - choosing appropriate graphics,
> - reading R output (data structures, basic plots).

------

### 1. Basic statistical concepts recap (统计基础概念回顾)

#### 1.1 Data, population, sample

- **Population (总体)**: the full set of units you care about (e.g. all USYD STAT5003 students).
- **Sample (样本)**: a subset of the population you actually observe.
  - In the quiz: “a subset of students who responded to the survey” is the **sample**. Week_01 (1)
- **Observation (观测 / 个体)**: one row in your data; one unit (e.g. one student).
- **Variable (变量)**: a measured characteristic on each observation (e.g. “hours studied per week”).

> **Exam-style use:** MCQ may ask you
>
> - to identify what is population vs sample,
> - or describe what an “observation” or “variable” is in a given scenario.

#### 1.2 Types of data / variables (数据类型)

From the quiz on “number of hours students study per week”: Week_01 (1)

- **Numeric / Quantitative (数值型)**
  - **Continuous (连续型)**: can take any value in an interval (e.g. weight, exact study hours).
  - **Discrete (离散型)**: takes distinct counts (e.g. # of courses enrolled).
- **Categorical (分类 / 定性)**
  - **Nominal (名义型)**: unordered categories (e.g. eye colour, cereal brand).
  - **Ordinal (有序分类)**: categories with an order (e.g. “low/medium/high satisfaction”).

> **Exam-style tasks:**
>
> - Given a description (“hours of study”, “course grade A/B/C”, “ID number”), decide if it is **continuous / discrete / categorical / ordinal**.
> - Connect variable type to suitable summaries/plots (e.g. histogram for numeric, bar plot for categorical).

------

### 2. Introduction to R, RStudio, R Projects & R Markdown

#### 2.1 What is R? (R 是什么) Week_01 (1)

- **R**: free, open-source software designed for **statistical computing (统计计算)** and **graphics (统计图形)**.
- Runs on **Windows / Mac / Linux**.
- Provides an **interactive environment** + **programming language (脚本语言)**.
- Real power comes from thousands of **packages (扩展包)** on CRAN, Bioconductor, GitHub.

**Keywords**

- *Package (包)*
- *Function (函数)*: e.g. `summary()`, `read.csv()`

#### 2.2 What is RStudio? (RStudio 是什么) Week_01 (1)

- **RStudio (RStudio 集成开发环境 IDE)**:
  - A front-end IDE for R (like a powerful text editor + project manager).
  - Manages console, scripts, environment, plots, files in panels.
- You must **install R first**, then RStudio.

#### 2.3 R Projects (R 项目) Week_01 (1)

- **RProject (.Rproj 文件)** groups scripts, data, and settings for one analysis.
- Each RStudio project has its own
  - **R session (R 会话)**,
  - **workspace (工作空间)**,
  - **history (命令历史)**,
  - **source documents (脚本文件)**.
- You can create a project in a new directory or an existing folder.
- Opening `.Rproj`
  - starts a new R session,
  - sets working directory to that project folder.

> **Exam relevance:**
>  They probably won’t ask “how to create a project”, but you must understand that **file paths, data reading** etc. assume a project/working directory.

#### 2.4 R Markdown (R Markdown 可复现文档)

From Week 1 outline: “Reproducible coding using Rmarkdown”. Week_01 (1)

- **R Markdown** allows you to mix:
  - **Narrative text (说明文字)**
  - **R code chunks (代码块)**
  - **Output (tables, figures)**
- Generates **HTML/PDF/Word reports** that are **reproducible** (可复现).

> **Exam relevance:**
>  More conceptual: understand what “reproducible analysis” means and why we document code & outputs together.

------

### 3. R data structures & basic data handling

#### 3.1 Workshop learning outcomes (Week 1) Workshop_week1

Workshop Week 1 focuses on:

1. **Data Structures (数据结构)**
   - **Data frame (数据框)**
   - **Factor (因子)**
   - **Vector (向量)**
   - **Matrix (矩阵)**
2. **File I/O (文件输入输出)** — reading & writing CSV.
3. **Numerical Summaries (数值摘要)** — `summary()` and basic statistics.
4. **Graphical Summaries (图形摘要)** — base plots.
5. **Data Manipulation (数据操作)** — filtering, subsetting and saving subsets.

All of these are heavily used in later weeks and in R outputs on the exam.

#### 3.2 File I/O – reading data (读取数据) Workshop_week1

Example with **`Cereal.csv`**:

- Use **`read.csv("Cereal.csv")`** to read a CSV file and assign to an object:

  ```
  cereal <- read.csv("Cereal.csv")
  ```

  - `cereal` becomes a **data frame (数据框)**: rows = cereals, columns = variables like `calories`, `fat`, `sodium`, etc. Workshop_week1

Useful inspection functions:

- `head(cereal)` — first few rows.
- `names(cereal)` — column names. Workshop_week1
- `str(cereal)` — structure of the data frame (variable types, number of observations). Workshop_week1

> **Exam-style:** you may be shown `str()` output and asked:
>
> - identify number of observations, variables,
> - interpret factor levels, numeric variables.

#### 3.3 Data frames and factors (数据框 & 因子)

Example with built-in dataset `warpbreaks`: Week_01 (1)

- `class(warpbreaks)` → `"data.frame"`
- `str(warpbreaks)` shows:
  - 54 observations of 3 variables:
    - `breaks`: numeric (number of breaks)
    - `wool`: factor with levels `"A"`, `"B"`
    - `tension`: factor with levels `"L"`, `"M"`, `"H"`
- **Factor (factor 因子)** = categorical variable with **levels (水平)**.
  - `Levels: A B` for `wool`.

Useful functions:

- `names(df)` — variable names.
- `head(df$wool)` — first values of a column.

> **Exam-style:**
>  They might give `str()` output and ask which variables are **categorical vs numeric**, or which is a **factor** and what its levels are.

#### 3.4 Converting data frames to matrices (转换为矩阵)

Workshop step:

```
cereal.numeric.matrix <- as.matrix(cereal.removed)
str(cereal.numeric.matrix)
```

- `as.matrix()` converts a data frame to a **numeric matrix (数值矩阵)** when all columns are numeric.
- `str()` then shows:
  - `num [1:77, 1:13] ...`
  - `dimnames`: 13 column names such as `"calories"`, `"protein"`, `"fat"`, `"sodium"`, etc.

> **Why important?** Many numerical algorithms (distance, linear algebra) work on **matrices**, not data frames.

------

### 4. Numerical descriptive statistics (数值描述性统计)

From the lecture “Descriptive statistics – numeric and graphics”: Week_01 (1)

#### 4.1 Measures of location (集中趋势指标)

- **Mean (均值)**
- **Median (中位数)**
- **Mode (众数)**
- For categorical data: **counts (频数)** and **proportions (比例)**.

#### 4.2 Measures of spread (离散程度)

- **Standard deviation, SD (标准差)**
- **MAD — Median Absolute Deviation (中位数绝对偏差)**
- **IQR — Interquartile Range (四分位距)**

#### 4.3 Other summaries

- **Minimum, Maximum (最小值/最大值)**
- **Quartiles (四分位数)**
- **Five-number summary (五数概括)**: min, Q1, median, Q3, max
  - used in **boxplots (箱线图)**.

#### 4.4 Using `summary()` and basic stats in R

Workshop example on `cereal$sodium`: Workshop_week1

```
summary(cereal$sodium)
# Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
# 0.0   130.0   180.0   159.7   210.0   320.0
```

- `1st Qu.` = Q1 (第一四分位数)
- `3rd Qu.` = Q3 (第三四分位数)
- `Median` (中位数)
- `Mean` (均值)

Other functions:

```
max(cereal$sodium)
min(cereal$sodium)
sd(cereal$sodium)
mean(cereal$sodium)
```

> **Exam-style:**
>
> - interpret a `summary()` output (which number is median? Q1? Q3?)
> - say whether the distribution seems skewed (if mean > median ⇒ right-skewed, etc.)
> - extract quartiles to describe spread.

------

### 5. Basic statistical graphics (基本统计图形)

#### 5.1 Types of graphics in this course Week_01 (1)

Slide “Types of graphics covered in this course”:

- Become familiar with **base R** graphics and **ggplot2**:
  - **base R**: built-in plotting functions (`plot()`, `hist()`, `boxplot()`, `barplot()`)
    - good for quick plots of simple datasets.
  - **ggplot2**: grammar-of-graphics package
    - better for more complex datasets and polished figures.

**Keywords**

- **Base R graphics (基础 R 图形)**
- **ggplot2 (ggplot 图形系统)**
- **Grammar of graphics (图形语法)**

#### 5.2 Example: simple plotting data frame Week_01 (1)

Week 1 constructs a simple data frame:

```
set.seed(5003)
example.dat <- data.frame(
  x   = rnorm(100),
  y   = runif(100),
  cat = sample(LETTERS[1:2], 100, replace = TRUE)
)
```

- `x`: normal random numbers
- `y`: uniform random numbers
- `cat`: categorical variable `"A"`/`"B"`

You can then:

- make a **scatterplot (散点图)** of `x` vs `y`
- colour by `cat`
- make histograms of `x`, boxplots of `y` etc.

> **Exam-style:**
>
> - Given a description (“compare distribution of a numeric variable across categories”), decide an appropriate plot (boxplot/histogram/bar).
> - Interpret what a given plot says about centre/spread/outliers.

------

### 6. Workshop Week 1 tasks – what skills you actually practised

From **Workshop Week 1** instructions:

1. **Create RStudio project & R Markdown file**
   - Shows you how to organise code in a project and write answers in `.Rmd`.
2. **File I/O with `Cereal.csv`**
   - `cereal <- read.csv("Cereal.csv")`
   - Inspect structure: `str(cereal)`, `names(cereal)`, `head(cereal)`.
3. **Data structures:**
   - Understand **data frames**, **factors**, **vectors**, **matrices** in real examples.
4. **Convert to numeric matrix:**
   - `cereal.numeric.matrix <- as.matrix(cereal.removed)`
   - `str(cereal.numeric.matrix)` to see numeric matrix structure.
5. **Numerical summary:**
   - `summary(cereal$sodium)` ⇒ quartiles, median, mean.
   - Other basics: `max()`, `min()`, `sd()`, `mean()`.
6. **Graphical summary:**
   - Although not all code is shown in the snippet, the LO emphasise
     - creating simple plots for visualisation (histogram, boxplot, scatterplot, etc.).

> **For the exam**:
>  You won’t be asked to write full scripts from scratch, but you must be able to:
>
> - read R output like `str()`, `summary()`, simple plot descriptions;
> - interpret what they say about type of variables, centre/spread, and distribution shape;
> - choose a suitable summary or graphic for a described task.

## 2. 代码

### 1. tutorial练习

```R
library(readr)
library(dplyr)
library(ggplot2)
library(here)

# 1. Read
here()
cereal <- read.csv(here('datasets', 'Cereal.csv'))
cereal %>% glimpse()
cereal %>% summary()

cereal %>% head(7)
cereal %>% class()
cereal %>% colnames()
cereal %>% nrow()
cereal %>% dim()

# 2. Data frames
# Extract the calories column
# vector
cal <- cereal$calories
# dataframe
cal <- cereal %>% select(calories)
# vector
cal <- cereal %>% pull(calories)
# Extract rows 1 to 10 from the cereal data frame.
cereal[1:10, ]
cereal %>% slice(1:10)

# Filter the cereal data frame to include only rows where mfr is "K" and assign it to Kelloggs.
kelloggs <- cereal %>% filter(mfr == "K")

# 3. factors
cereal.with.factors <- read.csv(here('datasets', 'Cereal.csv'), stringsAsFactors = TRUE)
str(cereal.with.factors) # only characters become factors
str(cereal)
levels(cereal.with.factors$mfr)
nlevels(cereal.with.factors$mfr)
str(cereal.with.factors$mfr)

# 4. vectors
cereal.cal <- cereal %>% select(calories) %>% pull()
cereal.cal %>% length()
cereal.cal[5:10]
cereal.cal <- c(cereal.cal, 1.0)
length(cereal.cal)

# 5. matrix
cereal.matrix <- as.matrix(cereal)
is.matrix(cereal.matrix)
cereal.removed <- cereal %>% select(-c(mfr, name, type))
cereal.removed |> colnames()
# Convert the 'cereal.removed' data frame to a numeric matrix.
cereal.numeric.matrix <- as.matrix(cereal.removed)
str(cereal.numeric.matrix)

summary(cereal$sodium)
mean.sodiums <- aggregate(sodium ~ mfr, data = cereal, FUN = mean)
mean.sodiums


# graphs
boxplot(sodium ~ mfr, data = cereal,
        xlab = "Manufacturer", ylab = "Sodium content", main = "Sodium Content by Manufacturer")

cereal %>% 
  ggplot(aes(x= mfr, y = sodium))+
  geom_boxplot() + 
  theme_classic() + 
  labs(x =  "Manufacturer", y = "Sodium content") + 
  ggtitle("Sodium Content by Manufacturer")


plot(calories ~ sodium, data = cereal, main = "Calories versus Sodium Scatter Plot")
cereal %>% 
  ggplot(aes(x = sodium, y = calories)) + 
  geom_point() + 
  geom_smooth(method = "lm", se = FALSE) + 
  labs(x =  "Sodium", y = "Carlories") + 
  ggtitle("Calories versus Sodium Scatter Plot")

# write to file
write.csv(kelloggs, here("datasets", "kelloggs.csv"))

```

### 2. ggplot2 常用“全家桶模板”

```R
library(ggplot2)  # 0. 加载绘图包 ------------------------------------------------

ggplot(
  data = df,      # 1. 数据源
  mapping = aes(  # 2. 全局美学映射：变量 → 视觉元素
    x = x_var,        # 横轴变量
    y = y_var,        # 纵轴变量
    color = group,    # 颜色映射（分类或连续）
    fill = group,     # 填充色映射（柱、面积、箱线图等）
    size = size_var,  # 点/线大小映射
    shape = cat_var,  # 点形状映射（分类）
    linetype = lt_var,# 线型映射（实线、虚线…）
    alpha = a_var,    # 透明度映射
    group = group_var # 分组，如果需要强行划分连线/填充的组
  )
) +
  geom_POINT_OR_LINE(
    data = df_layer,          # 3.1 图层自己的数据（可选，覆盖全局 data）
    mapping = aes(...),       # 3.2 图层自己的映射（可选，覆盖全局 aes）
    stat = "identity",        # 3.3 统计变换方式（计数、密度、回归线等）
    position = "identity",    # 3.4 几何对象位置调整（叠加、并排、抖动）
    show.legend = TRUE,       # 3.5 控制这一层是否出现在图例中
    inherit.aes = TRUE        # 3.6 是否继承全局 aes
  ) +
  stat_SOMETHING(
    mapping = aes(...),       # 4.1 只做统计变换的图层（可以单独设映射）
    geom = "smooth",          # 4.2 统计结果用什么几何对象来画
    position = "identity"     # 4.3 统计图层的位置调整
  ) +
  facet_wrap(                 # 5.1 一维拆分成小图（按某个变量分面）
    ~ facet_var,              #     行列排布由 ~ 右侧的分面变量决定
    nrow = 2, ncol = 3,       #     小图的排布行数、列数
    scales = "fixed"          #     各小图坐标轴是否共享范围（fixed/free）
  ) +
  facet_grid(                 # 5.2 二维分面（行变量 × 列变量）
    rows = vars(row_var),     #     按行划分的小图变量
    cols = vars(col_var),     #     按列划分的小图变量
    scales = "free_y"         #     比如只放开 y 轴范围
  ) +
  scale_x_continuous(         # 6.1 控制 x 轴数值刻度/标签/范围
    name = "X 轴标题",
    limits = c(x_min, x_max),
    breaks = c(...),
    labels = c(...)
  ) +
  scale_y_continuous(         # 6.2 控制 y 轴数值刻度/标签/范围
    name = "Y 轴标题",
    limits = c(y_min, y_max),
    breaks = c(...),
    labels = c(...)
  ) +
  scale_color_manual(         # 6.3 手动指定颜色映射（线/点颜色）
    name   = "颜色图例标题",
    values = c("A" = "red", "B" = "blue"),
    breaks = c("A", "B"),
    labels = c("组A", "组B")
  ) +
  scale_fill_brewer(          # 6.4 使用调色板设置填充色（柱图、箱线图等）
    palette = "Set2"
  ) +
  coord_cartesian(            # 7.1 笛卡尔坐标系，并可裁剪显示范围
    xlim = c(x_min, x_max),
    ylim = c(y_min, y_max),
    expand = TRUE
  ) +
  # coord_flip() +            # 7.2 交换 x/y 轴（水平柱状图等）
  # coord_polar() +           # 7.3 极坐标（饼图、极坐标柱图）
  labs(                       # 8. 添加各种文字标签
    title    = "主标题",
    subtitle = "副标题",
    caption  = "数据来源/备注",
    x        = "X 轴标题",
    y        = "Y 轴标题",
    color    = "颜色图例标题",
    fill     = "填充图例标题",
    size     = "大小图例标题",
    shape    = "形状图例标题"
  ) +
  theme_bw() +                # 9.1 套用一个整体主题风格（背景/网格等）
  theme(                      # 9.2 细调主题（字体、间距、线条、图例位置等）
    text = element_text(family = "STHeiti", size = 12),
    panel.grid.major = element_line(),
    panel.grid.minor = element_blank(),
    legend.position = "right",
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(hjust = 0.5)
  ) +
  guides(                     # 10. 精细控制图例外观和顺序
    color = guide_legend(order = 1),
    fill  = guide_legend(order = 2),
    size  = guide_legend(order = 3)
  ) +
  annotate(                   # 11. 手动加文字/线/箭头等注释
    geom = "text",
    x = x0, y = y0,
    label = "这里是一个关键点",
    hjust = 0, vjust = 1
  )
```

### 3. `geom_smooth(method = "lm", se = FALSE)` 逐个拆开

假设你代码类似这样：

```
ggplot(cereal, aes(x = calories, y = rating)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE)
```

#### 1. `geom_smooth(...)` 是干嘛的？

`geom_smooth()`：

> **根据散点数据，画出一条“平滑曲线 / 拟合线”，表示 y 随 x 的总体趋势。**

默认会帮你做两件事：

1. 根据你给的 `x`、`y` 做某种统计拟合（比如平滑曲线、回归线）
2. 把拟合结果画成线（`line`）+ 可选的置信区间带（`ribbon`）

------

#### 2. `method = "lm"`

`method` 决定“用什么算法来拟合这条线”。

- `method = "lm"`：

  > 使用 `lm()`（linear model），也就是**线性回归**，画一条直线：
  >  形状是：  y=a+bxy = a + b xy=a+bx

举例：
 `rating ~ calories` 画出来就是“评分随卡路里变化的线性趋势”。

常见的 `method` 还有：

- 不写 `method`：自动选择（小数据量用 `loess`，大数据量用 `gam`）
- `method = "loess"`：本地加权平滑曲线（适合非线性趋势，小数据）
- `method = "gam"`：广义加性模型，更复杂的平滑形式
- `method = "glm"`：广义线性模型，比如 logistic 回归等

你这里写 `method = "lm"` 是明确告诉 ggplot：**我就要一条直线回归线**。

> 另外还可以配合 `formula`，比如：
>
> ```
> geom_smooth(method = "lm", formula = y ~ x)           # 默认线性
> geom_smooth(method = "lm", formula = y ~ poly(x, 2)) # 二次曲线
> ```

------

#### 3. `se = FALSE`

`se` 指的是 “standard error” 的那条**置信区间带**。

- `se = TRUE`（默认）：

  > 画出拟合线的同时，在周围加一条半透明的“带子”，代表拟合线的置信区间（默认 95%）。

- `se = FALSE`：

  > **只画线，不画那圈阴影**，图看起来更干净。

比如：

```
geom_smooth(method = "lm", se = TRUE)   # 有带子
geom_smooth(method = "lm", se = FALSE)  # 只有一条线
```

你这里写 `se = FALSE` 就是：**我只想看趋势线，不要那片阴影。**

------

### 4. `geom_smooth()` 的整体用法（帮你建立“模板”认知）

#### 1. 最简单的用法

```
ggplot(cars, aes(x = speed, y = dist)) +
  geom_point() +
  geom_smooth()
```

- 不写 `method`：ggplot 会根据数据量自动选方法（小样本用 `loess`，画一条弯曲的平滑线）。
- 默认 `se = TRUE`：会有一条线 + 一圈置信区间。

一句话：**什么都不管，就想看 x–y 散点的总体趋势，用 `geom_smooth()` 就行。**

------

#### 2. 常见参数一览（每个一句话）

```
geom_smooth(
  mapping = NULL,     # 这一层自己的 aes（可以覆盖全局 aes）
  data = NULL,        # 这一层单独用的数据
  method = NULL,      # 拟合方法：lm、loess、gam、glm 等
  formula = y ~ x,    # 拟合公式（配合 method，指定模型形式）
  se = TRUE,          # 是否画出置信区间带
  level = 0.95,       # 置信区间置信度（默认 95%）
  span = 0.75,        # loess 平滑程度（越小越“紧”越弯）
  fullrange = FALSE,  # 回归线只画数据范围内/还是扩展整个坐标轴范围
  color = ...,        # 固定设置线的颜色
  linetype = ...,     # 固定设置线型
  size = ...,         # 线的粗细
  inherit.aes = TRUE  # 是否继承 ggplot() 里的 aes
)
```

重点几个：

- `method`：**决定线的“形状类型”**（直？弯？什么算法？）
- `formula`：**告诉它 y 和 x 的关系形式**（直线，多项式……）
- `se`、`level`：**要不要置信区间，以及置信水平是多少**
- `fullrange`：**线是仅覆盖数据范围，还是画满整个坐标轴**
- `mapping`：可以给 `geom_smooth()` 专门设颜色、分组，比如按厂商各自一条线